# 商品模块表定义

## 概述
商品模块包含商品信息管理、商品规格管理、商品分类管理、供应商管理以及库存价格缓存等核心功能。支持实体商品和线下优惠券/消费券两种商品类型，通过SKU管理商品规格，支持多级分类体系。

## 表结构定义

### 1. 商品表 (t_product_product)

#### 表结构
```sql
CREATE TABLE t_product_product (
    id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
    product_name VARCHAR(200) NOT NULL COMMENT '商品名称',
    product_code VARCHAR(50) UNIQUE NOT NULL COMMENT '商品编码',
    product_type VARCHAR(20) NOT NULL DEFAULT 'PHYSICAL' COMMENT '商品类型：PHYSICAL-实体商品，VIRTUAL-虚拟商品，COUPON-优惠券',
    category_id BIGINT COMMENT '商品分类ID',
    supplier_id BIGINT COMMENT '供应商ID',
    brand_name VARCHAR(100) COMMENT '品牌名称',
    description TEXT COMMENT '商品描述',
    main_image VARCHAR(500) COMMENT '主图URL',
    image_urls TEXT COMMENT '商品图片URL集合（JSON格式）',
    video_url VARCHAR(500) COMMENT '视频URL',
    original_price DECIMAL(10,2) COMMENT '原价',
    sell_price DECIMAL(10,2) COMMENT '销售价',
    cost_price DECIMAL(10,2) COMMENT '成本价',
    stock_quantity INT DEFAULT 0 COMMENT '总库存数量',
    sales_count INT DEFAULT 0 COMMENT '销售数量',
    view_count INT DEFAULT 0 COMMENT '浏览次数',
    status TINYINT(1) NOT NULL DEFAULT 1 COMMENT '商品状态：1-上架，2-下架，3-售罄，4-删除',
    is_hot TINYINT(1) NOT NULL DEFAULT 0 COMMENT '是否热销：0-否，1-是',
    is_recommend TINYINT(1) NOT NULL DEFAULT 0 COMMENT '是否推荐：0-否，1-是',
    sort_order INT DEFAULT 0 COMMENT '排序序号',
    weight DECIMAL(10,3) COMMENT '重量（kg）',
    volume_length DECIMAL(10,3) COMMENT '长度（cm）',
    volume_width DECIMAL(10,3) COMMENT '宽度（cm）',
    volume_height DECIMAL(10,3) COMMENT '高度（cm）',
    expiry_date DATETIME COMMENT '过期时间',
    produce_date DATETIME COMMENT '生产日期',
    shelf_life_days INT COMMENT '保质期（天）',
    virtual_content TEXT COMMENT '虚拟商品内容',
    coupon_type VARCHAR(20) COMMENT '优惠券类型：DISCOUNT-折扣券，CASH-现金券，EXCHANGE-兑换券',
    coupon_value DECIMAL(10,2) COMMENT '优惠券面值',
    coupon_condition DECIMAL(10,2) COMMENT '使用条件',
    usage_instruction TEXT COMMENT '使用说明',

    -- 审计字段
    created_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    created_by VARCHAR(100) COMMENT '创建人',
    updated_by VARCHAR(100) COMMENT '更新人',
    is_deleted TINYINT(1) NOT NULL DEFAULT 0 COMMENT '是否删除：0-未删除，1-已删除',
    version INT NOT NULL DEFAULT 1 COMMENT '版本号，用于乐观锁',

    -- 索引
    UNIQUE KEY uk_product_code (product_code),
    INDEX idx_category_id (category_id),
    INDEX idx_supplier_id (supplier_id),
    INDEX idx_product_type (product_type),
    INDEX idx_status (status),
    INDEX idx_is_hot (is_hot),
    INDEX idx_is_recommend (is_recommend),
    INDEX idx_sort_order (sort_order),
    INDEX idx_created_time (created_time),
    INDEX idx_is_deleted (is_deleted),
    INDEX idx_category_status (category_id, status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='商品表';
```

#### 业务节点说明

**创建节点**：
- 管理员在后台创建新商品时录入商品信息
- 系统批量导入商品数据时创建商品记录
- 供应商提供商品信息时创建商品记录
- 商品上架时设置商品状态和价格信息

**变更节点**：
- 商品信息更新时修改商品基本信息
- 商品价格调整时更新价格字段
- 商品状态变更时更新status字段
- 商品库存变化时更新库存相关字段
- 商品上下架操作时修改状态

**删除节点**：
- 商品下架且不再销售时逻辑删除
- 商品信息错误需要清理时删除
- 供应商商品下架时同步删除

---

### 2. 商品SKU表 (t_product_sku)

#### 表结构
```sql
CREATE TABLE t_product_sku (
    id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
    product_id BIGINT NOT NULL COMMENT '商品ID',
    sku_code VARCHAR(50) UNIQUE NOT NULL COMMENT 'SKU编码',
    sku_name VARCHAR(200) NOT NULL COMMENT 'SKU名称',
    spec_combination VARCHAR(500) COMMENT '规格组合（JSON格式）',
    image_url VARCHAR(500) COMMENT 'SKU图片URL',
    original_price DECIMAL(10,2) COMMENT '原价',
    sell_price DECIMAL(10,2) NOT NULL COMMENT '销售价',
    cost_price DECIMAL(10,2) COMMENT '成本价',
    stock_quantity INT NOT NULL DEFAULT 0 COMMENT '库存数量',
    sales_count INT DEFAULT 0 COMMENT '销售数量',
    weight DECIMAL(10,3) COMMENT '重量（kg）',
    volume_length DECIMAL(10,3) COMMENT '长度（cm）',
    volume_width DECIMAL(10,3) COMMENT '宽度（cm）',
    volume_height DECIMAL(10,3) COMMENT '高度（cm）',
    status TINYINT(1) NOT NULL DEFAULT 1 COMMENT 'SKU状态：1-正常，2-禁用',

    -- 审计字段
    created_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    created_by VARCHAR(100) COMMENT '创建人',
    updated_by VARCHAR(100) COMMENT '更新人',
    is_deleted TINYINT(1) NOT NULL DEFAULT 0 COMMENT '是否删除：0-未删除，1-已删除',
    version INT NOT NULL DEFAULT 1 COMMENT '版本号，用于乐观锁',

    -- 索引
    UNIQUE KEY uk_sku_code (sku_code),
    INDEX idx_product_id (product_id),
    INDEX idx_status (status),
    INDEX idx_created_time (created_time),
    INDEX idx_is_deleted (is_deleted)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='商品SKU表';
```

#### 业务节点说明

**创建节点**：
- 商品创建时自动生成默认SKU
- 管理员为商品添加新的规格组合时创建SKU
- 商品规格调整时创建新的SKU记录

**变更节点**：
- SKU价格调整时更新价格信息
- SKU库存变化时更新库存数量
- SKU规格信息修改时更新规格组合
- SKU状态变更时更新状态

**删除节点**：
- 商品规格取消时删除对应SKU
- 商品下架时清理相关SKU
- 库存为0且不再补货时删除SKU

---

### 3. 商品分类表 (t_product_category)

#### 表结构
```sql
CREATE TABLE t_product_category (
    id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
    category_name VARCHAR(100) NOT NULL COMMENT '分类名称',
    category_code VARCHAR(50) UNIQUE NOT NULL COMMENT '分类编码',
    parent_id BIGINT DEFAULT 0 COMMENT '父分类ID，0表示一级分类',
    level TINYINT(1) NOT NULL DEFAULT 1 COMMENT '分类层级：1-一级，2-二级，3-三级',
    description VARCHAR(500) COMMENT '分类描述',
    icon_url VARCHAR(500) COMMENT '分类图标URL',
    sort_order INT DEFAULT 0 COMMENT '排序序号',
    status TINYINT(1) NOT NULL DEFAULT 1 COMMENT '状态：1-正常，0-禁用',
    product_count BIGINT DEFAULT 0 COMMENT '分类下商品数量',

    -- 审计字段
    created_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    created_by VARCHAR(100) COMMENT '创建人',
    updated_by VARCHAR(100) COMMENT '更新人',
    is_deleted TINYINT(1) NOT NULL DEFAULT 0 COMMENT '是否删除：0-未删除，1-已删除',
    version INT NOT NULL DEFAULT 1 COMMENT '版本号，用于乐观锁',

    -- 索引
    UNIQUE KEY uk_category_code (category_code),
    INDEX idx_parent_id (parent_id),
    INDEX idx_level (level),
    INDEX idx_status (status),
    INDEX idx_sort_order (sort_order),
    INDEX idx_created_time (created_time),
    INDEX idx_is_deleted (is_deleted)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='商品分类表';
```

#### 业务节点说明

**创建节点**：
- 管理员创建新的商品分类
- 系统初始化时创建基础分类
- 运营人员根据商品规划创建新分类

**变更节点**：
- 分类名称和描述更新时修改信息
- 分类排序调整时更新sort_order
- 分类下商品数量变化时更新product_count
- 分类状态变更时更新status

**删除节点**：
- 分类不再使用时逻辑删除
- 分类合并时清理旧分类
- 系统重构时清理无效分类

---

### 4. 商品供应商表 (t_product_supplier)

#### 表结构
```sql
CREATE TABLE t_product_supplier (
    id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
    supplier_name VARCHAR(100) NOT NULL COMMENT '供应商名称',
    supplier_code VARCHAR(50) UNIQUE NOT NULL COMMENT '供应商编码',
    contact_name VARCHAR(50) COMMENT '联系人姓名',
    contact_phone VARCHAR(20) COMMENT '联系人电话',
    contact_email VARCHAR(100) COMMENT '联系人邮箱',
    company_address VARCHAR(200) COMMENT '公司地址',
    business_license VARCHAR(200) COMMENT '营业执照',
    tax_id VARCHAR(50) COMMENT '税务登记号',
    bank_name VARCHAR(100) COMMENT '开户银行',
    bank_account VARCHAR(50) COMMENT '银行账号',
    settlement_cycle VARCHAR(20) DEFAULT 'MONTHLY' COMMENT '结算周期：WEEKLY-周结，MONTHLY-月结，QUARTERLY-季结',
    cooperation_status TINYINT(1) NOT NULL DEFAULT 1 COMMENT '合作状态：1-正常，2-暂停，3-终止',
    product_count INT DEFAULT 0 COMMENT '供应商品数量',
    total_amount DECIMAL(15,2) DEFAULT 0 COMMENT '累计供应金额',

    -- 审计字段
    created_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    created_by VARCHAR(100) COMMENT '创建人',
    updated_by VARCHAR(100) COMMENT '更新人',
    is_deleted TINYINT(1) NOT NULL DEFAULT 0 COMMENT '是否删除：0-未删除，1-已删除',
    version INT NOT NULL DEFAULT 1 COMMENT '版本号，用于乐观锁',

    -- 索引
    UNIQUE KEY uk_supplier_code (supplier_code),
    INDEX idx_contact_phone (contact_phone),
    INDEX idx_contact_email (contact_email),
    INDEX idx_cooperation_status (cooperation_status),
    INDEX idx_created_time (created_time),
    INDEX idx_is_deleted (is_deleted)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='商品供应商表';
```

#### 业务节点说明

**创建节点**：
- 新供应商入驻时创建供应商信息
- 管理员添加供应商时录入信息
- 系统批量导入供应商数据

**变更节点**：
- 供应商信息更新时修改联系方式等
- 合作状态变化时更新状态
- 供应商品数量变化时更新统计信息
- 结算信息变更时更新银行账号等

**删除节点**：
- 供应商停止合作时逻辑删除
- 供应商信息合并时清理重复记录
- 系统清理无效供应商信息

---

### 5. 商品库存缓存表 (t_product_stock_cache)

#### 表结构
```sql
CREATE TABLE t_product_stock_cache (
    id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
    sku_id BIGINT NOT NULL COMMENT 'SKU ID',
    product_id BIGINT NOT NULL COMMENT '商品ID',
    available_stock INT NOT NULL DEFAULT 0 COMMENT '可用库存',
    locked_stock INT DEFAULT 0 COMMENT '锁定库存',
    total_stock INT NOT NULL DEFAULT 0 COMMENT '总库存',
    safety_stock INT DEFAULT 0 COMMENT '安全库存',
    last_update_time DATETIME NOT NULL COMMENT '最后更新时间',

    -- 审计字段
    created_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    created_by VARCHAR(100) COMMENT '创建人',
    updated_by VARCHAR(100) COMMENT '更新人',
    is_deleted TINYINT(1) NOT NULL DEFAULT 0 COMMENT '是否删除：0-未删除，1-已删除',
    version INT NOT NULL DEFAULT 1 COMMENT '版本号，用于乐观锁',

    -- 索引
    UNIQUE KEY uk_sku_id (sku_id),
    INDEX idx_product_id (product_id),
    INDEX idx_available_stock (available_stock),
    INDEX idx_last_update_time (last_update_time),
    INDEX idx_created_time (created_time),
    INDEX idx_is_deleted (is_deleted)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='商品库存缓存表';
```

#### 业务节点说明

**创建节点**：
- SKU创建时同步创建库存缓存记录
- 商品上架时初始化库存缓存

**变更节点**：
- 库存发生变化时实时更新缓存
- 库存锁定和解锁时更新锁定库存
- 安全库存调整时更新相关字段

**删除节点**：
- SKU删除时清理库存缓存
- 商品下架时删除缓存记录

---

### 6. 商品价格缓存表 (t_product_price_cache)

#### 表结构
```sql
CREATE TABLE t_product_price_cache (
    id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
    sku_id BIGINT NOT NULL COMMENT 'SKU ID',
    product_id BIGINT NOT NULL COMMENT '商品ID',
    original_price DECIMAL(10,2) COMMENT '原价',
    sell_price DECIMAL(10,2) NOT NULL COMMENT '销售价',
    cost_price DECIMAL(10,2) COMMENT '成本价',
    discount_rate DECIMAL(5,4) COMMENT '折扣率',
    discount_start_time DATETIME COMMENT '折扣开始时间',
    discount_end_time DATETIME COMMENT '折扣结束时间',
    last_update_time DATETIME NOT NULL COMMENT '最后更新时间',

    -- 审计字段
    created_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    created_by VARCHAR(100) COMMENT '创建人',
    updated_by VARCHAR(100) COMMENT '更新人',
    is_deleted TINYINT(1) NOT NULL DEFAULT 0 COMMENT '是否删除：0-未删除，1-已删除',
    version INT NOT NULL DEFAULT 1 COMMENT '版本号，用于乐观锁',

    -- 索引
    UNIQUE KEY uk_sku_id (sku_id),
    INDEX idx_product_id (product_id),
    INDEX idx_sell_price (sell_price),
    INDEX idx_discount_end_time (discount_end_time),
    INDEX idx_last_update_time (last_update_time),
    INDEX idx_created_time (created_time),
    INDEX idx_is_deleted (is_deleted)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='商品价格缓存表';
```

#### 业务节点说明

**创建节点**：
- SKU创建时同步创建价格缓存记录
- 商品价格初始化时创建缓存

**变更节点**：
- 商品价格调整时更新缓存
- 促销活动开始时更新折扣信息
- 价格政策变更时批量更新缓存

**删除节点**：
- SKU删除时清理价格缓存
- 商品下架时删除缓存记录

---

### 7. 商品销量缓存表 (t_product_sales_cache)

#### 表结构
```sql
CREATE TABLE t_product_sales_cache (
    id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
    sku_id BIGINT NOT NULL COMMENT 'SKU ID',
    product_id BIGINT NOT NULL COMMENT '商品ID',
    daily_sales INT DEFAULT 0 COMMENT '今日销量',
    weekly_sales INT DEFAULT 0 COMMENT '本周销量',
    monthly_sales INT DEFAULT 0 COMMENT '本月销量',
    total_sales INT DEFAULT 0 COMMENT '累计销量',
    daily_sales_date DATE COMMENT '今日销量统计日期',
    last_update_time DATETIME NOT NULL COMMENT '最后更新时间',

    -- 审计字段
    created_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    created_by VARCHAR(100) COMMENT '创建人',
    updated_by VARCHAR(100) COMMENT '更新人',
    is_deleted TINYINT(1) NOT NULL DEFAULT 0 COMMENT '是否删除：0-未删除，1-已删除',
    version INT NOT NULL DEFAULT 1 COMMENT '版本号，用于乐观锁',

    -- 索引
    UNIQUE KEY uk_sku_id (sku_id),
    INDEX idx_product_id (product_id),
    INDEX idx_total_sales (total_sales),
    INDEX idx_monthly_sales (monthly_sales),
    INDEX idx_last_update_time (last_update_time),
    INDEX idx_created_time (created_time),
    INDEX idx_is_deleted (is_deleted)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='商品销量缓存表';
```

#### 业务节点说明

**创建节点**：
- SKU创建时初始化销量缓存记录
- 商品上架时创建销量统计

**变更节点**：
- 订单成交时更新销量统计
- 每日定时任务更新日销量
- 每周/月定时任务更新周/月销量

**删除节点**：
- SKU删除时清理销量缓存
- 商品下架时删除缓存记录

---

### 8. 商品进出库日志表 (t_product_stock_in_out_log)

#### 表结构
```sql
CREATE TABLE t_product_stock_in_out_log (
    id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
    sku_id BIGINT NOT NULL COMMENT 'SKU ID',
    product_id BIGINT NOT NULL COMMENT '商品ID',
    operation_type VARCHAR(20) NOT NULL COMMENT '操作类型：IN-入库，OUT-出库，ADJUST-调整',
    quantity INT NOT NULL COMMENT '操作数量',
    before_stock INT NOT NULL COMMENT '操作前库存',
    after_stock INT NOT NULL COMMENT '操作后库存',
    operation_reason VARCHAR(200) COMMENT '操作原因',
    batch_number VARCHAR(50) COMMENT '批次号',
    supplier_id BIGINT COMMENT '供应商ID',
    warehouse_location VARCHAR(100) COMMENT '仓库位置',
    operator_id BIGINT COMMENT '操作人ID',
    operator_name VARCHAR(100) COMMENT '操作人姓名',
    related_order_id BIGINT COMMENT '关联订单ID',
    related_order_item_id BIGINT COMMENT '关联订单商品ID',

    -- 时间字段
    created_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',

    -- 索引
    INDEX idx_sku_id (sku_id),
    INDEX idx_product_id (product_id),
    INDEX idx_operation_type (operation_type),
    INDEX idx_supplier_id (supplier_id),
    INDEX idx_operator_id (operator_id),
    INDEX idx_related_order_id (related_order_id),
    INDEX idx_created_time (created_time),
    INDEX idx_sku_time (sku_id, created_time)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='商品进出库日志表'

-- 分区策略（按月分区）
PARTITION BY RANGE (YEAR(created_time)) (
    PARTITION p2024 VALUES LESS THAN (2025),
    PARTITION p2025 VALUES LESS THAN (2026),
    PARTITION p2026 VALUES LESS THAN (2027),
    PARTITION p_future VALUES LESS THAN MAXVALUE
);
```

#### 业务节点说明

**创建节点**：
- 商品入库时记录入库日志
- 订单出库时记录出库日志
- 库存调整时记录调整日志
- 系统自动盘点时记录日志

**变更节点**：
- 通常进出库日志不进行变更，以保证日志的不可篡改性

**删除节点**：
- 按时间定期清理过期日志（通常保留2年）
- 系统存储空间不足时清理最旧的日志

---

### 9. 商品价格变更日志表 (t_product_price_change_log)

#### 表结构
```sql
CREATE TABLE t_product_price_change_log (
    id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
    sku_id BIGINT NOT NULL COMMENT 'SKU ID',
    product_id BIGINT NOT NULL COMMENT '商品ID',
    old_original_price DECIMAL(10,2) COMMENT '变更前原价',
    new_original_price DECIMAL(10,2) COMMENT '变更后原价',
    old_sell_price DECIMAL(10,2) COMMENT '变更前销售价',
    new_sell_price DECIMAL(10,2) COMMENT '变更后销售价',
    old_cost_price DECIMAL(10,2) COMMENT '变更前成本价',
    new_cost_price DECIMAL(10,2) COMMENT '变更后成本价',
    change_reason VARCHAR(200) COMMENT '变更原因',
    change_type VARCHAR(20) COMMENT '变更类型：MANUAL-手动调整，PROMOTION-促销活动，SYSTEM-系统调整',
    operator_id BIGINT COMMENT '操作人ID',
    operator_name VARCHAR(100) COMMENT '操作人姓名',
    approval_status TINYINT(1) DEFAULT 1 COMMENT '审批状态：1-已审批，0-待审批',
    effective_time DATETIME COMMENT '生效时间',

    -- 时间字段
    created_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',

    -- 索引
    INDEX idx_sku_id (sku_id),
    INDEX idx_product_id (product_id),
    INDEX idx_change_type (change_type),
    INDEX idx_operator_id (operator_id),
    INDEX idx_approval_status (approval_status),
    INDEX idx_effective_time (effective_time),
    INDEX idx_created_time (created_time),
    INDEX idx_sku_time (sku_id, created_time)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='商品价格变更日志表'

-- 分区策略（按月分区）
PARTITION BY RANGE (YEAR(created_time)) (
    PARTITION p2024 VALUES LESS THAN (2025),
    PARTITION p2025 VALUES LESS THAN (2026),
    PARTITION p2026 VALUES LESS THAN (2027),
    PARTITION p_future VALUES LESS THAN MAXVALUE
);
```

#### 业务节点说明

**创建节点**：
- 管理员手动调整商品价格时记录日志
- 促销活动开始/结束时记录价格变更
- 系统自动调整价格时记录日志

**变更节点**：
- 价格变更审批通过时更新审批状态
- 补充变更信息时更新相关字段

**删除节点**：
- 按时间定期清理过期日志（通常保留1年）
- 系统存储优化时清理最旧的日志

---

## 数据管理策略

### 数据清理策略
1. **基础商品数据**：永久保留，除非商品完全下架
2. **库存缓存数据**：随商品生命周期清理
3. **价格缓存数据**：随商品生命周期清理
4. **销量缓存数据**：永久保留，用于统计分析
5. **进出库日志**：保留2年，超过2年的数据归档
6. **价格变更日志**：保留1年，超过1年的数据清理

### 性能优化策略
1. **分区表**：日志表按月分区，提升查询性能
2. **索引优化**：建立复合索引满足常见查询需求
3. **读写分离**：日志表主要写入，查询相对较少
4. **缓存策略**：商品信息和库存信息使用Redis缓存

### 安全策略
1. **价格敏感操作审计**：所有价格变更必须记录操作日志
2. **库存变更追踪**：所有库存变更都有完整的操作记录
3. **权限控制**：商品管理和库存管理需要严格的权限验证
4. **数据一致性**：通过事务保证库存和价格数据的一致性
